#!/usr/bin/env node
/**
 * fortune-data.plain.json を読み、難読化した fortune-data.js を出力する。
 * 本番用の配布時はこのスクリプトを実行してからデプロイする。
 */

const fs = require('fs');
const path = require('path');

const ROOT = path.resolve(__dirname, '..');
const PLAIN = path.join(ROOT, 'fortune-data.plain.json');
const OUT = path.join(ROOT, 'fortune-data.js');

function main() {
  const json = fs.readFileSync(PLAIN, 'utf8');
  const b64 = Buffer.from(json, 'utf8').toString('base64');
  const js = `// Generated by scripts/obfuscate-fortune.js — edit fortune-data.plain.json and re-run to update
(function(){try{var b=atob("${b64}");var u=new Uint8Array(b.length);for(var i=0;i<b.length;i++)u[i]=b.charCodeAt(i);var d=JSON.parse(new TextDecoder("utf-8").decode(u));window.__FORTUNE_DATA__=d;}catch(e){console.error("Fortune data load error",e);window.__FORTUNE_DATA__={quotes:[],destructionLaws:[]};}})();
`;
  fs.writeFileSync(OUT, js, 'utf8');
  console.log('Written:', OUT);
  console.log('  payload length (base64):', b64.length);
}

main();
